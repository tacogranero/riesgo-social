# Generar archivo HTML completo con el código solicitado para que el usuario pueda subirlo a GitHub
html_code = """
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Índice de Riesgo Social (IRS) - Automático</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; max-width: 900px; }
    h1 { color: #2c3e50; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { padding: 8px; margin-top: 5px; width: 100%; max-width: 300px; }
    button { margin-top: 20px; padding: 10px 20px; font-weight: bold; cursor: pointer; }
    #resultado { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
    #recomendacion { margin-top: 15px; font-style: italic; color: #34495e; }
    #alertaRoja { margin-top: 10px; padding: 10px; background-color: #e74c3c; color: white; font-weight: bold; display: none; }
    canvas { margin-top: 30px; max-width: 100%; height: 300px; }
  </style>
</head>
<body>
  <h1>Índice de Riesgo Social (IRS) - Argentina</h1>

  <label for="region">Seleccionar Región / Provincia:</label>
  <select id="region">
    <option value="">Seleccione...</option>
  </select>

  <label for="ingresoModal">Ingreso Familiar Modal (ARS):</label>
  <input type="number" id="ingresoModal" min="0" step="1000" />

  <label for="cbt">Canasta Básica Total (ARS):</label>
  <input type="number" id="cbt" min="0" step="1000" />

  <label for="cba">Canasta Básica Alimentaria (ARS):</label>
  <input type="number" id="cba" min="0" step="1000" />

  <label for="tarifas">Gasto Mensual en Tarifas (ARS):</label>
  <input type="number" id="tarifas" min="0" step="1000" />

  <label for="desempleo">Tasa de Desempleo (%):</label>
  <input type="number" id="desempleo" min="0" max="100" step="0.1" />

  <label for="inflacion">Inflación Mensual Proyectada (%):</label>
  <input type="number" id="inflacion" min="0" max="100" step="0.1" />

  <button id="btnCargarDatos">Cargar Datos Inflación y Desempleo (BCRA)</button>
  <button id="btnExportar">Exportar Resultado a Excel</button>

  <div id="resultado"></div>
  <div id="recomendacion"></div>
  <div id="alertaRoja">🚨 Riesgo Social Crítico - Atención Urgente 🚨</div>

  <canvas id="irsChart"></canvas>

  <script>
    const datosRegional = {
      "Total País": { ingreso: 380000, cbt: 690902, cba: 320000 },
      "Noroeste": { ingreso: 250000, cbt: 600000, cba: 280000 },
      "Noreste": { ingreso: 260000, cbt: 610000, cba: 290000 },
      "Cuyo": { ingreso: 350000, cbt: 670000, cba: 310000 },
      "Centro": { ingreso: 420000, cbt: 700000, cba: 330000 },
      "Patagonia": { ingreso: 480000, cbt: 720000, cba: 350000 },
      "Buenos Aires": { ingreso: 400000, cbt: 690000, cba: 320000 },
      "CABA": { ingreso: 460000, cbt: 710000, cba: 340000 }
    };

    const selectRegion = document.getElementById('region');
    const ingresoModal = document.getElementById('ingresoModal');
    const cbtInput = document.getElementById('cbt');
    const cbaInput = document.getElementById('cba');
    const tarifasInput = document.getElementById('tarifas');
    const desempleoInput = document.getElementById('desempleo');
    const inflacionInput = document.getElementById('inflacion');
    const resultadoDiv = document.getElementById('resultado');
    const recomendacionDiv = document.getElementById('recomendacion');
    const alertaRojaDiv = document.getElementById('alertaRoja');

    Object.keys(datosRegional).forEach(region => {
      const option = document.createElement('option');
      option.value = region;
      option.textContent = region;
      selectRegion.appendChild(option);
    });

    const ctx = document.getElementById('irsChart').getContext('2d');
    const irsChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Empobrecimiento', 'Inseguridad Alimentaria', 'Tarifas', 'Desempleo', 'Inflación'],
        datasets: [{
          label: 'Nivel de Riesgo (%)',
          backgroundColor: ['#e74c3c', '#f39c12', '#3498db', '#9b59b6', '#2ecc71'],
          data: [0, 0, 0, 0, 0]
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true, max: 200 } },
        plugins: { legend: { display: false } }
      }
    });

    let datosIRS = {};

    function generarRecomendacion(riesgoTotal) {
      if (riesgoTotal < 30) return 'Mantener políticas de inclusión y fortalecimiento del consumo interno.';
      if (riesgoTotal < 50) return 'Impulsar programas de empleo y contención social con enfoque territorial.';
      if (riesgoTotal < 70) return 'Reforzar subsidios focalizados, reactivación económica y control de precios esenciales.';
      return 'Aplicar políticas redistributivas urgentes: control estatal de servicios básicos, aumento de salarios y transferencia directa a sectores vulnerables.';
    }

    function calcularIRS() {
      const ingreso = parseFloat(ingresoModal.value);
      const cbt = parseFloat(cbtInput.value);
      const cba = parseFloat(cbaInput.value);
      const tarifas = parseFloat(tarifasInput.value);
      const desempleo = parseFloat(desempleoInput.value);
      const inflacion = parseFloat(inflacionInput.value);

      if ([ingreso, cbt, cba, tarifas, desempleo, inflacion].some(v => isNaN(v) || v < 0)) {
        resultadoDiv.textContent = 'Complete todos los campos con valores válidos.';
        recomendacionDiv.textContent = '';
        alertaRojaDiv.style.display = 'none';
        return;
      }

      const riesgoEmpobrecimiento = (cbt / ingreso) * 100;
      const riesgoAlimentario = (cba / ingreso) * 100;
      const riesgoTarifas = (tarifas / ingreso) * 100;

      irsChart.data.datasets[0].data = [
        riesgoEmpobrecimiento,
        riesgoAlimentario,
        riesgoTarifas,
        desempleo,
        inflacion
      ];
      irsChart.update();

      const riesgoTotal = (riesgoEmpobrecimiento + riesgoAlimentario + riesgoTarifas + desempleo + inflacion) / 5;

      let mensaje;
      if (riesgoTotal < 30) mensaje = 'Nivel de riesgo social: Bajo 🟢';
      else if (riesgoTotal < 50) mensaje = 'Nivel de riesgo social: Medio 🟡';
      else if (riesgoTotal < 70) mensaje = 'Nivel de riesgo social: Alto 🟠';
      else mensaje = 'Nivel de riesgo social: Crítico 🔴';

      resultadoDiv.textContent = mensaje;
      recomendacionDiv.textContent = generarRecomendacion(riesgoTotal);
      alertaRojaDiv.style.display = riesgoTotal >= 70 ? 'block' : 'none';

      datosIRS = {
        'Región / Provincia': selectRegion.value,
        'Ingreso Familiar Modal (ARS)': ingreso,
        'Canasta Básica Total (ARS)': cbt,
        'Canasta Básica Alimentaria (ARS)': cba,
        'Gasto en Tarifas (ARS)': tarifas,
        'Desempleo (%)': desempleo,
        'Inflación Proyectada (%)': inflacion,
        'Riesgo Empobrecimiento (%)': riesgoEmpobrecimiento.toFixed(2),
        'Riesgo Alimentario (%)': riesgoAlimentario.toFixed(2),
        'Riesgo Tarifas (%)': riesgoTarifas.toFixed(2),
        'Riesgo Total Promedio (%)': riesgoTotal.toFixed(2),
        'Clasificación': mensaje,
        'Recomendación': recomendacionDiv.textContent
      };
    }

    selectRegion.addEventListener('change', () => {
      const datos = datosRegional[selectRegion.value];
      if (datos) {
        ingresoModal.value = datos.ingreso;
        cbtInput.value = datos.cbt;
        cbaInput.value = datos.cba;
        calcularIRS();
      }
    });

    [ingresoModal, cbtInput, cbaInput, tarifasInput, desempleoInput, inflacionInput].forEach(input => {
      input.addEventListener('input', calcularIRS);
    });

    document.getElementById('btnCargarDatos').addEventListener('click', async () => {
      const token = "eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3ODE1NTcyOTEsInR5cGUiOiJleHRlcm5hbCIsInVzZXIiOiJ0YWNvZ3JhbmVyb0BnbWFpbC5jb20ifQ.bDfszx350Qx7FsZ3mhe-EvgNk5emC-zr1EY4SlwP_OPzYVDnGxS9fBdEKSMYuXHLVBCpy7RT5Ewgzk9npawADA";
      const url = "https://api.estadisticasbcra.com/principales_variables";
      try {
        const response = await fetch(url, { headers: { Authorization: `BEARER ${token}` } });
        if (!response.ok) throw new Error(`Error en la respuesta: ${response.status}`);
        const datos = await response.json();
        const inflacionData = datos.find(item => item.id === 'inflacion_mensual');
        const inflacionReciente = inflacionData?.datos?.slice(-1)[0]?.valor;
        if (inflacionReciente) {
          inflacionInput.value = inflacionReciente.toFixed(2);
        } else {
          alert('No se pudo obtener inflación mensual del BCRA.');
        }
        desempleoInput.value = 8.3;
        alert('Datos económicos cargados desde BCRA con éxito.');
        calcularIRS();
      } catch (error) {
        alert('Error al obtener datos económicos desde BCRA. Revise token o conexión.');
        console.error(error);
      }
    });

    document.getElementById('btnExportar').addEventListener('click', () => {
      if (!Object.keys(datosIRS).length) {
        alert('Primero realice un cálculo válido.');
        return;
      }
      const hoja = [Object.keys(datosIRS), Object.values(datosIRS)];
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(hoja);
      XLSX.utils.book_append_sheet(wb, ws, 'IRS');
      XLSX.writeFile(wb, 'Indice_Riesgo_Social.xlsx');
    });

    selectRegion.value = "Total País";
    selectRegion.dispatchEvent(new Event('change'));
  </script>
</body>
</html>
"""

# Guardar archivo en /mnt/data
file_path = "/mnt/data/indice_riesgo_social.html"
with open(file_path, "w", encoding="utf-8") as f:
    f.write(html_code)

file_path
