<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ndice de Riesgo Social</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    canvas { margin-top: 20px; }
    button { padding: 10px 15px; margin-top: 10px; cursor: pointer; }
    #recomendacion { margin-top: 20px; font-style: italic; background: #e8f5e9; padding: 10px; border-left: 4px solid #2e7d32; }
    #alertaRoja { margin-top: 20px; font-weight: bold; color: red; font-size: 1.2em; display: none; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Calculadora de ndice de Riesgo Social (IRS)</h2>
    <form id="irsForm">
      <label for="region">Seleccionar Regi贸n:</label>
      <select id="region"></select>

      <label>Ingreso Familiar Modal (ARS):</label>
      <input type="number" id="ingresoModal" value="380000" />

      <label>Canasta B谩sica Total (CBT):</label>
      <input type="number" id="cbt" value="690902" />

      <label>Canasta B谩sica Alimentaria (CBA):</label>
      <input type="number" id="cba" value="320000" />

      <label>Gasto Mensual en Tarifas:</label>
      <input type="number" id="tarifas" value="110000" />

      <label>Tasa de Desempleo (%):</label>
      <input type="number" id="desempleo" value="8" />

      <label>Inflaci贸n Proyectada (% mensual):</label>
      <input type="number" id="inflacion" value="6" />

      <button type="button" onclick="cargarDatosEconomicos()">Cargar Datos Econ贸micos</button>
      <button type="submit">Calcular IRS</button>
      <button type="button" onclick="exportarExcel()">Exportar a Excel</button>
    </form>

    <canvas id="irsChart"></canvas>
    <div id="resultado" style="margin-top: 20px;"></div>
    <div id="recomendacion"></div>
    <div id="alertaRoja">锔 Alerta: El 铆ndice de riesgo social ha alcanzado un nivel cr铆tico. Se recomienda intervenci贸n inmediata.</div>
  </div>

  <script>
    const provincias = [
      "Total Pa铆s", "Noroeste", "Noreste", "Cuyo", "Centro", "Patagonia",
      "Buenos Aires", "CABA", "Catamarca", "Chaco", "Chubut", "C贸rdoba",
      "Corrientes", "Entre R铆os", "Formosa", "Jujuy", "La Pampa", "La Rioja",
      "Mendoza", "Misiones", "Neuqu茅n", "R铆o Negro", "Salta", "San Juan",
      "San Luis", "Santa Cruz", "Santa Fe", "Santiago del Estero", "Tierra del Fuego", "Tucum谩n"
    ];

    const valoresRegionales = {};
    provincias.forEach(p => valoresRegionales[p] = { ingreso: 380000, cbt: 690902, cba: 320000 });

    const select = document.getElementById('region');
    provincias.forEach(p => {
      const option = document.createElement('option');
      option.value = p;
      option.textContent = p;
      select.appendChild(option);
    });

    const form = document.getElementById('irsForm');
    const ctx = document.getElementById('irsChart').getContext('2d');

    const chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Empobrecimiento', 'Inseguridad Alimentaria', 'Tarifas', 'Desempleo', 'Inflaci贸n'],
        datasets: [{
          label: 'Nivel de Riesgo (%)',
          backgroundColor: ['#e74c3c', '#f39c12', '#3498db', '#9b59b6', '#2ecc71'],
          data: [0, 0, 0, 0, 0]
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: { beginAtZero: true, max: 200 }
        }
      }
    });

    let datosIRS = {};

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const region = document.getElementById('region').value;
      const valores = valoresRegionales[region] || valoresRegionales["Total Pa铆s"];

      document.getElementById('ingresoModal').value = valores.ingreso;
      document.getElementById('cbt').value = valores.cbt;
      document.getElementById('cba').value = valores.cba;

      const ingreso = parseFloat(document.getElementById('ingresoModal').value);
      const cbt = parseFloat(document.getElementById('cbt').value);
      const cba = parseFloat(document.getElementById('cba').value);
      const tarifas = parseFloat(document.getElementById('tarifas').value);
      const desempleo = parseFloat(document.getElementById('desempleo').value);
      const inflacion = parseFloat(document.getElementById('inflacion').value);

      const riesgoEmpobrecimiento = (cbt / ingreso) * 100;
      const riesgoAlimentario = (cba / ingreso) * 100;
      const riesgoTarifas = (tarifas / ingreso) * 100;

      chart.data.datasets[0].data = [
        riesgoEmpobrecimiento,
        riesgoAlimentario,
        riesgoTarifas,
        desempleo,
        inflacion
      ];
      chart.update();

      const riesgoTotal = (riesgoEmpobrecimiento + riesgoAlimentario + riesgoTarifas + desempleo + inflacion) / 5;

      let mensaje;
      if (riesgoTotal < 30) mensaje = 'Nivel de riesgo social: Bajo ';
      else if (riesgoTotal < 50) mensaje = 'Nivel de riesgo social: Medio ';
      else if (riesgoTotal < 70) mensaje = 'Nivel de riesgo social: Alto ';
      else mensaje = 'Nivel de riesgo social: Cr铆tico ';

      document.getElementById('resultado').innerText = mensaje;

      const recomendacion = generarRecomendaciones(riesgoTotal);
      document.getElementById('recomendacion').innerText = recomendacion;

      const alertaRoja = document.getElementById('alertaRoja');
      if (riesgoTotal >= 70) {
        alertaRoja.style.display = 'block';
      } else {
        alertaRoja.style.display = 'none';
      }

      datosIRS = {
        'Regi贸n': region,
        'Ingreso Modal': ingreso,
        'CBT': cbt,
        'CBA': cba,
        'Tarifas': tarifas,
        'Desempleo (%)': desempleo,
        'Inflaci贸n Proyectada (%)': inflacion,
        'Riesgo Empobrecimiento (%)': riesgoEmpobrecimiento.toFixed(2),
        'Riesgo Alimentario (%)': riesgoAlimentario.toFixed(2),
        'Riesgo Tarifas (%)': riesgoTarifas.toFixed(2),
        'Riesgo Total (%)': riesgoTotal.toFixed(2),
        'Clasificaci贸n': mensaje,
        'Recomendaci贸n': recomendacion
      };
    });

    function generarRecomendaciones(riesgoTotal) {
      if (riesgoTotal < 30) return 'Mantener pol铆ticas de inclusi贸n y fortalecimiento del consumo interno.';
      if (riesgoTotal < 50) return 'Impulsar programas de empleo y contenci贸n social con enfoque territorial.';
      if (riesgoTotal < 70) return 'Reforzar subsidios focalizados, reactivaci贸n econ贸mica y control de precios esenciales.';
      return 'Aplicar pol铆ticas redistributivas urgentes: control estatal de servicios b谩sicos, aumento de salarios y transferencia directa a sectores vulnerables.';
    }

    function exportarExcel() {
      const hoja = [Object.keys(datosIRS), Object.values(datosIRS)];
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(hoja);
      XLSX.utils.book_append_sheet(wb, ws, 'IRS');
      XLSX.writeFile(wb, 'Indice_Riesgo_Social.xlsx');
    }

    async function cargarDatosEconomicos() {
      try {
        const response = await fetch("https://api.estadisticasbcra.com/inflacion_mensual", {
          headers: { Authorization: "BEARER TU_TOKEN_AQUI" }
        });
        const datos = await response.json();
        const inflacion = datos[datos.length - 1].valor;
        const desempleo = 8.3; // reemplazar con dato real cuando est茅 disponible

        document.getElementById("inflacion").value = inflacion.toFixed(2);
        document.getElementById("desempleo").value = desempleo;
      } catch (error) {
        console.error("Error al cargar datos econ贸micos:", error);
      }
    }
  </script>
</body>
</html>
